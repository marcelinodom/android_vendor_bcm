#!/system/bin/sh

# A faster and more stable props system for scripts during boot.
# Properly because this does not go troue the trigger system like the build-in props system does.

if [ ! -d /tmp ]; then
	busybox mount -o remount,rw /
	busybox mkdir /tmp
	busybox chown 1000.2001 /tmp
	busybox chmod 771 /tmp
	busybox mount -t tmpfs -o size=42M,nr_inodes=42k,mode=0770 tmpfs /tmp
	busybox mkdir /tmp/props
	busybox chown 1000.1000 /tmp/props
	busybox chmod 771 /tmp/props
	busybox mount -o remount,ro /
fi

case "$1" in
	"initiate")
		# In case you need to create the tmp dir before using any props
		[ -d /tmp/props ] && echo "true" || echo "false"
	;;

	"remove")
		[ ! -z "$2" ] && [ -e /tmp/props/$2 ] && busybox rm -rf /tmp/props/$2
	;;

	"set")
		[ ! -z "$2" ] && busybox echo "$3" > /tmp/props/$2
	;;

	"get")
		if [ ! -z "$2" ]; then
			[ -e /tmp/props/$2 ] && busybox cat /tmp/props/$2

		else
			for i in /tmp/props/*; do
				echo "[`busybox basename $i`]: [`cat $i`]"
			done
		fi
	;;

	*)
		echo "Usage:"
		echo ""
		echo "props get <name>"
		echo "props remove <name> "
		echo "props set <name> <value>"
	;;
esac

